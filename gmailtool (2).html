<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>eFone Gmail-ready Email Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background: #f6f7fb; margin: 0; padding: 20px; }
  .panel { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
  .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
  input[type=text] { padding:8px 10px; font-size:14px; border:1px solid #ddd; border-radius:6px; width:300px; }
  button { padding:10px 16px; border-radius:6px; border:none; cursor:pointer; background:linear-gradient(90deg,#B43DCE,#664ED4); color:white; font-weight:600; }
  button.secondary { background:#eef2ff; color:#222; border:1px solid #ddd; }
  .cols { display:grid; grid-template-columns:1fr 450px; gap:16px; }
  textarea.template { width:100%; height:500px; border:1px solid #ddd; padding:12px; font-family:monospace; font-size:13px; border-radius:6px; resize:vertical; }
  iframe.preview { border:1px solid #ddd; height:500px; border-radius:6px; }
  .small { font-size:13px; color:#666; margin-top:8px; }
</style>
</head>
<body>

<div class="panel">
  <h2>eFone Gmail-ready Email Editor</h2>

  <div class="toolbar">
    <input id="recipientInput" type="text" placeholder="Recipient (e.g., Moeed &lt;moeed@example.com&gt; or moeed@example.com)">
    <button id="fillBtn">Auto-fill Name</button>
    <button id="copyBtn">Copy HTML</button>
    <button id="previewBtn" class="secondary">Preview</button>
  </div>

  <div class="cols">
    <div>
      <label class="small">Email template:</label>
      <textarea id="templateArea" class="template" spellcheck="false"></textarea>
      <div class="small">Use <code>{name}</code> or <code>[[NAME]]</code> as the placeholder for the recipient's first name.</div>
    </div>
    <div>
      <label class="small">Preview:</label>
      <iframe id="previewFrame" class="preview"></iframe>
    </div>
  </div>
</div>

<script>
// Updated email template with your content
const defaultTemplate = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>eFone Email</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; padding:0; background:#ffffff; font-family:Arial,sans-serif; }
.container { max-width:600px; margin:auto; background:#ffffff; padding:20px; color:#333; line-height:1.6; }
h1 { text-align:center; color:#000000; font-size:24px; }
.greeting { font-size:18px; margin-top:10px; margin-bottom:20px; }
.highlight { color:#B43DCE; }
.btn { display:inline-block; background:linear-gradient(to right,#B43DCE,#664ED4); color:#fff !important; padding:14px 22px; text-decoration:none; font-size:16px; font-weight:bold; border-radius:6px; }
.footer { text-align:center; margin-top:40px; font-size:13px; color:#666666; }
</style>
</head>
<body>
<div class="container">

<h1>Hello <span class="highlight">{name}</span>,</h1>

<p>I'm sharing something that can make staying connected easier.</p>

<p><strong>eFone</strong> helps you stay connected effortlessly. Whether you’re calling friends, family, or handling everyday communication — it’s simple, reliable, and made for everyday use.</p>

<p>If you want an easy at-home calling solution, <strong>HomePhone</strong> is designed exactly for that:</p>

<ul>
  <li><strong>Plug-and-Play Setup</strong> — just connect and call</li>
  <li><strong>Voicemail, call forwarding</strong> & other helpful features</li>
  <li><strong>Reliable connection</strong> when it matters most</li>
</ul>

<p>Experience stress-free home communication with HomePhone.</p>

<div style="text-align:center; margin:30px 0;">
<a href="https://efone.app/homephone/?ref=welcome_email" class="btn">Get Started with HomePhone Today →</a>
</div>

<div class="footer">
eFone – Keeping You Connected.<br>
Need help? Reach us at <a href="mailto:support@efone.app" style="color:#B43DCE;">support@efone.app</a>.
</div>

</div>
</body>
</html>
`;

// Elements
const templateArea = document.getElementById('templateArea');
const recipientInput = document.getElementById('recipientInput');
const fillBtn = document.getElementById('fillBtn');
const copyBtn = document.getElementById('copyBtn');
const previewBtn = document.getElementById('previewBtn');
const previewFrame = document.getElementById('previewFrame');

templateArea.value = defaultTemplate;
renderPreview(defaultTemplate);

// Functions
function toTitleCase(str){ return str.replace(/\b[a-z]/g, m=>m.toUpperCase()); }

function parseName(recipient){
  recipient = recipient.trim();
  const match = recipient.match(/^(.*?)\s*<[^>]+>$/);
  if(match && match[1]) return toTitleCase(match[1].replace(/["']/g,'').trim());
  const emailMatch = recipient.match(/^([^@]+)@/);
  if(emailMatch){
    const parts = emailMatch[1].split(/[._\-+]/).filter(Boolean);
    if(parts.length >= 2) return toTitleCase(parts[0] + ' ' + parts[1]);
    return toTitleCase(parts[0]);
  }
  return toTitleCase(recipient);
}

function replaceName(html, name){
  return html.replace(/\{\{?name\}?\}/gi, name).replace(/\[\[NAME\]\]/g, name);
}

function renderPreview(html){
  const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
  doc.open();
  doc.write(html);
  doc.close();
}

// Events
fillBtn.addEventListener('click', ()=>{
  const recipient = recipientInput.value.trim();
  if(!recipient){ alert('Enter recipient email first'); return; }
  const name = parseName(recipient);
  const newHtml = replaceName(templateArea.value, name);
  templateArea.value = newHtml;
  renderPreview(newHtml);
  alert('Name inserted: ' + name + '\nNow copy HTML and paste into Gmail compose.');
});

copyBtn.addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(templateArea.value);
    alert('HTML copied to clipboard. Paste into Gmail compose (Ctrl+V).');
  } catch(e){
    alert('Copy failed. Select all and copy manually.');
  }
});

previewBtn.addEventListener('click', ()=>{
  renderPreview(templateArea.value);
});
</script>

</body>
</html>
